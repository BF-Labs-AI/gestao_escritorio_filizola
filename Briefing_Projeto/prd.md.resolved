# Product Requirements Document (PRD)

**Produto:** CRM F√°brica Jur√≠dica Dantas & Filizola  
**Vers√£o:** 1.0.0  
**Data:** 23 de Fevereiro de 2026  
**Status:** Em Defini√ß√£o Estrat√©gica  

---

## 1. Vis√£o Geral Executiva

O **CRM F√°brica Jur√≠dica Dantas & Filizola** √© um ecossistema operacional desenhado para gerir e escalar o core business previdenci√°rio do escrit√≥rio em alta velocidade. O sistema transforma fluxos anal√≥gicos baseados em interven√ß√£o humana constante em uma "esteira de f√°brica" invis√≠vel, previs√≠vel e baseada em IA. 

O cora√ß√£o do sistema √© composto por **11 Rob√¥s de Automa√ß√£o** que ingerem documentos desestruturados (fotos/PDFs), processam, validam, geram pe√ßas jur√≠dicas (Peti√ß√µes/Relat√≥rios) e monitoram ativamente os portais do governo (Meu INSS).

**Objetivo Central:** Reduzir o tempo de triagem documental, eliminar o risco de "processos esquecidos" ou "prazos perdidos", e permitir que a lideran√ßa (Gestora) apenas audite visualmente e tome decis√µes de protocolo sem precisar manipular pap√©is.

---

## 2. Perfis de Usu√°rio (Personas) e Permiss√µes

A plataforma ter√° tr√™s n√≠veis prim√°rios de intera√ß√£o humana, todas ocorrendo em um painel Web din√¢mico e seguro:

| Perfil | Acesso no Frontend | Responsabilidade Principal |
| :--- | :--- | :--- |
| **Advogado/Atendente** | N√≠vel Operacional | Inser√ß√£o bruta. Atende o cliente presencialmente, tira fotos dos documentos f√≠sicos e faz o _upload dry_ diretamente no painel do cliente no CRM. Preenche dados cadastrais base. |
| **Gestora/Revisora** | N√≠vel Decis√£o (Painel Gerencial) | Analisa a fila do "Pacote Final" gerado pelos rob√¥s. Utiliza o modo "Split Screen" (Relat√≥rio Inteligente √† esquerda + PDF Mesclado √† direita) para dar o crivo de aprova√ß√£o ou devolver o ticket com pend√™ncias objetivas. |
| **S√≥cio/Admin** | N√≠vel Sist√™mico (Full Access) | Vis√£o executiva. Acompanha m√©tricas (painel do Figma), status dos 2.000+ processos e controla a "fila de alarme" do Rob√¥ 10 (exig√™ncias e prazos cr√≠ticos no limite). |

---

## 3. Topologia e Arquitetura Tecnol√≥gica

### 3.1. Frontend (A Interface da Opera√ß√£o)
Aplica√ß√£o **React/Next.js** constru√≠da com foco em alta densidade de dados e clareza visual, fugindo de templates SaaS convencionais. Inspirada em pain√©is de Performance de Vendas e Controle Financeiro:
*   Tabelas expans√≠veis (`DataGrids`) para a carteira de +2.000 processos.
*   Uso estrat√©gico de *badges* coloridas para status sem√¢nticos (ex: Vermelho para `EXIGENCIA_PRAZO_CURTO`).
*   Viewer integrado de PDFs lado a lado com pain√©is de a√ß√£o.

### 3.2. Backend & Orquestra√ß√£o (Supabase)
Todo o controle de estado e filas residir√° no **Supabase**:
*   **Database (PostgreSQL):** Modelagem hiper-relacional (Clientes, Processos, Logs de Evento INSS, Tarefas dos Rob√¥s).
*   **Storage Privado:** Bucket seguro com restri√ß√£o RLS (Row Level Security) para arquivos de clientes.

### 3.3. Motores de IA e RPA (Os Rob√¥s)
Os 11 rob√¥s ser√£o divididos em dois formatos tecnol√≥gicos acoplados ao Supabase:
*   **Edge Functions do Supabase:** Processar√£o em serverless o tr√°fego dos Rob√¥s 1 a 4 e 6 a 9. Para tarefas cognitivas (OCR, leitura de laudos com CID, extra√ß√£o de hist√≥rico temporal), as fun√ß√µes se integrar√£o nativamente √† API da **OpenAI** (LLMs vision√°rios).
*   **Servi√ßos de RPA Cont√≠nuo (Scrapers):** Os Rob√¥s 5 (Inser√ß√£o/Protocolo) e 10 (Sentinela) atuar√£o por fora do plano serverless nativo due limites de _timeout_ do Supabase. Ser√£o scripts robustos (Python/Playwright ou Node.js/Puppeteer) embarcados pelo pr√≥prio CRM, navegando "headless" no Meu INSS via senhas institucionais.

---

## 4. O Fluxo de Valor: A Esteira dos 11 Rob√¥s

Para clareza de desenvolvimento, o sistema est√° segmentado em 4 √©picos fundamentais.

### √âpico A: Ingest√£o e Estrutura√ß√£o Documental (Top of Funnel)
Esta fase consolida a bagun√ßa inicial do Advogado/Atendente em pastas estruturadas.

*   **ü§ñ R1 - O Classificador Visual:** Acionado no momento do upload. Identifica (usando GPT Vision) frente/verso, corta bordas, valida leitura mandat√≥ria (ex. se √© RG leg√≠vel), converte TUDO para PDF no Storage. *Status:* `DOCS_OK` ou `DOCS_PENDENTES`.
*   **ü§ñ R2 - O Montador de Buckets:** Pega o input do R1 e distribui nos diret√≥rios virtuais l√≥gicos daquele cliente no sistema (`01_DADOS_PESSOAIS`, `06_INSS`, etc.). Cria um *√çndice Geral* metadado no banco.
*   **ü§ñ R3 - O Porteiro (Auditor R√≠gido):** Baseado em regras duras do Postgres (ex: ID e Comprovante de Resid√™ncia devem existir). Impede o avan√ßo do processo se o laudo m√©dico n√£o possuir a string de CID v√°lida extra√≠da.
*   **ü§ñ R4 - Checklist Jur√≠dico de Trava:** L√≥gica de neg√≥cio. Analisa a inten√ß√£o do benef√≠cio vs os documentos do R2 validados pelo R3. *Output:* `LIBERADO` ou `BLOQUEADO`.

### √âpico B: Intelig√™ncia e Gera√ß√£o de Pe√ßas (Middle of Funnel)
Onde a automa√ß√£o substitui horas de digita√ß√£o jur√≠dica.

*   **ü§ñ R6 - O Extrator de Cl√≠nica:** O componente mais complexo de IA. Escaneia todos os laudos/exames (04_MEDICOS). Busca diagn√≥stico, limita√ß√µes funcionais (f√≠sico/cognitivo), temporalidade e salva matriz JSON.
*   **ü§ñ R7 - Buscador de Jurisprud√™ncia:** Filtra a base ou RAG por tribunal regional cruzando com o CID extra√≠do no R6.
*   **ü§ñ R8 - Peti√ß√£o Din√¢mica:** Mescla o cadastro + matriz do R6 + R7 em um template `.docx` padr√£o do escrit√≥rio.

### √âpico C: Fechamento Anal√≠tico e A√ß√£o de Protocolo (Bottom of Funnel)
Onde a Gestora avalia o dossi√™ finalizado e d√° o "Go/No-go".

*   **ü§ñ R9 - O Empacotador Mestre:** Confere se R1 a R8 fecharam 100%. Autopreenche procura√ß√µes em branco usando o cadastro. Gera um **Relat√≥rio Resumo em Word** focado em limita√ß√µes (Ponto D e F). Une todos os PDFs organizados em um Super-Arquivo Final de auditoria paralela. Acende a luz no Dashboard: `‚úÖ PRONTO PARA APROVA√á√ÉO`.
*   **üë§ A√ß√£o Humana (Gestora):** Confere e clica no bot√£o "Aprovar Protocolo".
*   **ü§ñ R5 - RPA de Protocolo:** Script "Headless" entra no portal oficial e espelha os dados aprobat√≥rios e manda o Super-Arquivo + anexos pro governo. Traz a *DER* (Data de Entrada) de volta ao sistema Database.

### √âpico D: Sentinela de Manuten√ß√£o da Carteira (P√≥s-Protocolo)
Garante o andamento ininterrupto.

*   **ü§ñ R10 - Monitoria Em Lote (2.000+):** Script de Raspagem de Dados Di√°ria (Batch Scraping). Em ciclos fechados, loga institucionalmente na lista de requerimentos e faz "diff" de status do portal contra o banco de dados. Qualquer altera√ß√£o (`EXIGENCIA`, `PERICIA`, `INDEFERIDO`) √© extra√≠da em Txt/Pdf e catalogada, subindo um log de `MUDAN√áA_EVENTO`. Altera sem√°foros no Frontend da Gest√£o priorizando os com D-0 / D-3 nos prazos.
*   **ü§ñ R11 - O Comunicador Disparo:** L√™ as inser√ß√µes do R10. Tem uma tabela de mensageria base parametrizada (ex: Se For MUDAN√áA=Exig√™ncia Mande "Sr(a) Cliente, o INSS solicitou um documento num prazo de X..."). Usa WhatsApp API para dar fluidez.

---

## 5. Requisitos N√£o Funcionais Cr√≠ticos (NFRs)

*   **NFR 01 - Performance O(n):** A tela da Gestora e do S√≥cio, embora liste e relacione centenas/milhares de processos com dezenas de colunas, devera usar pagina√ß√£o `limit/offset` inteligente, cache Redis/Supabase Edge e evitar blocos de interface pesados. Inspirar em Datagrids financeiras de alta velocidade.
*   **NFR 02 - LGPD e Isolamento de Storage:** Documentos originais s√£o propriedade cl√≠nica. O bucket Supabase do R2 em diante existir√° sob politicas blindadas de `auth.uid() = user_id`, sem tokens publicos perpetuos. Logs completos em trilhas de auditoria das interven√ß√µes de cada gestora/agente de mesa.
*   **NFR 03 - Abstra√ß√£o e Recupera√ß√£o RPA (R10):** Um scraper web di√°rio possui fragilidade ao markup da p√°gina oficial do governo. O R10 precisa alertar falhas de parsing ao setor de engenharia separadamente sem mascar√°-la como um "sem mudan√ßa" na UI.

---

## 6. Proposta de MVP e Cronograma √Ågil (Pr√≥ximos Passos)
Para evitar gargalos, a inicializa√ß√£o se dar√° particionada:

1.  **Fase 1 (Banco de dados e Rob√¥ 1 at√© o 4) + Cadastro:** Parametriza√ß√£o Supabase. Estrutura√ß√£o fundamental com testes do R1 passando via Edge Function e OCR da OpenAI processando os arquivos base nas pastas do usuario final.
2.  **Fase 2 (Rob√¥ 6 ao 9) + MVP UI da Gest√£o:** UI completa de aprova√ß√£o cruzando laudos com a matriz montada e templates ".docx".
3.  **Fase 3 (RPA Hardcore - Rob√¥ 5 e 10):** Constru√ß√£o dos Scrapers de automa√ß√£o headless no Portal Oficial Meu INSS.
4.  **Fase 4 (Disparo R11 e Est√©tica Fina):** Dashboards de volumetria socio/admin e mensageria Zap integrada.
